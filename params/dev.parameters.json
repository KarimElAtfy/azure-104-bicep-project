{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
   
        "location":{"value": "eastus"},


        "vnet": {
            "value": {
                "name": "vnet-dev-001",
                "addressPrefixes": ["10.0.0.0/16"],
                "subnets": [
                    {"name": "snet-dev-web-01","prefix": "10.0.0.0/24"},
                    {"name": "snet-dev-db-01","prefix": "10.0.1.0/24"},
                    {"name": "AzureBastionSubnet","prefix": "10.0.2.0/24"}
                ]
            }
        },


        "storageAccount": {"value" : {"name": "stgdev0000"}},


        "NSG": {
            "value" : {

                "name": "nsg-shared-dev-01",

                "rules": [
                    {
                        "name": "in-allow-rdp-admin",

                        "properties" : {
                            "description": "Allow RDP for admin",
                            "protocol": "Tcp",
                            "sourcePortRange": "*",
                            "destinationPortRange": "3389",
                            "sourceAddressPrefix": "REPLACE_WITH_ADMIN_IP",
                            "destinationAddressPrefix": "*",
                            "access": "Allow",
                            "priority": 400,
                            "direction": "Inbound"
                        }
                    },

                    {
                        "name": "allow-http",

                        "properties" : {
                            "description": "Allow HTTP",
                            "protocol": "Tcp",
                            "sourcePortRange": "*",
                            "destinationPortRange": "80",
                            "sourceAddressPrefix": "*",
                            "destinationAddressPrefix": "*",
                            "access": "Allow",
                            "priority": 420,
                            "direction": "Inbound"
                        }
                    }

                    
                ]
         
            }
        },

        "WinWebConfig":{
            "value" : {
                "vmSize" : "Standard_D2s_v3",
                "adminUsername" : "adminuser",
                "basename" : "dev",
                "count": 2,
                "scriptUri": "https://storageaccount.blob.core.windows.net/scripts/install-webserver.ps1?<sas-token>"
            }
        },

        "winWebAdminPassword": {
            "reference": {
                "keyVault": {
                    "id": "/subscriptions/<subscription-id>/resourceGroups/<rg-name>/providers/Microsoft.KeyVault/vaults/<kv-name>"
                },

                "secretName": "winwebadmin"
            }
        },

        "bastion": {
            "value": {
                "pipName": "pip-bastion-dev-01",
                "name": "bastion-dev-01"
            }
        },

        "lbname": {
            "value": "lb-dev-01"
        },

        "linuxWebConfig":{
            "value" : {
                "baseName": "test-app",
                "vmSize": "Standard_B1s",
                "count": 1,
                "adminUsername": "linuxadmin"
            }
        },

        "linuxWebAdminPassword": {
            "reference": {
                "keyVault": {
                    "id": "/subscriptions/<subscription-id>/resourceGroups/<rg-name>/providers/Microsoft.KeyVault/vaults/<kv-name>"
                },

                "secretName": "linuxwebadmin"
            }
        },

        "testvnet": {
            "value": {
                "name": "vnet-test-001",
                "addressPrefixes": ["10.1.0.0/16"],
                "subnets": [
                    {"name": "snet-test-app","prefix": "10.1.0.0/24"}
                ]
            }
        }

    }

}
